# Разведочный анализ данных по мошенничеству

## 1. Цель проекта

Провести разведочный анализ набора транзакционных данных с метками мошенничества, выявить ключевые паттерны и сформулировать продуктовые и технические гипотезы для улучшения антифрод-системы.

## 2. Инструменты и окружение

- **Язык:** Python 3.10+
- **Библиотеки:**
  - `pandas`, `numpy` — работа с данными
  - `matplotlib`, `seaborn` — визуализация
  - `pyarrow` — загрузка Parquet-файлов

## 3. Структура репозитория

```
fraud/
├── data/
│   ├── transaction_fraud_data.parquet
│   └── historical_currency_exchange.parquet
├── free_analyze.py
├── requirements.txt
└── README.md
```

Внутри проекта нужно создать папку data с файлами:

transaction_fraud_data.parquet

historical_currency_exchange.parquet

https://clck.ru/3NTNrY

https://clck.ru/3NTNzU

## 4. Предобработка

1. **Чтение данных:**  
   ```python
   transactions = pd.read_parquet(
       'data/transaction_fraud_data.parquet',
       columns=COLUMNS,
       engine='pyarrow'
   )
   ```
2. **Оптимизация типов:**  
   - `timestamp` → `datetime64[ns]` (UTC → без часовой зоны)  
   - Категориальные признаки (`currency`, `country`, `city`, `device`, `vendor_category`) → `category`  
   - Булевы признаки → `bool`  
   - Целочисленные признаки (`hour`, `day_of_week`) → `int8`  
   - Суммы → `float32`
3. **Извлечение признаков времени:**  
   ```python
   transactions['hour'] = transactions['timestamp'].dt.hour
   transactions['day_of_week'] = transactions['timestamp'].dt.dayofweek
   transactions['date'] = transactions['timestamp'].dt.normalize()
   ```
4. **Конвертация валют:**  
   - Загрузка `historical_currency_exchange.parquet`  
   - Преобразование в длинный формат (`melt`)  
   - `merge` по `date` + `currency`  
   - Расчёт `amount_usd = amount / rate_to_usd`
5. **Уменьшение ОЗУ:**  
   - Чтение только нужных столбцов  
   - Удаление временных объектов + `gc.collect()`

## 5. Базовая статистика

- **Использование памяти:** вывод объёма DataFrame (MB)
- **Уровень мошенничества:** доля `is_fraud == True`

## 6. Визуализации

Для тяжёлых графиков используется случайная выборка 10% транзакций.

1. **Распределение суммы транзакций** (лог-шкала) — сравнение легитимных и мошеннических операций.
2. **Корреляционная матрица** ключевых числовых признаков (`amount_usd`, `hour`, `day_of_week`, `is_fraud`).
3. **Топ-10 IP-адресов** по количеству фрод-транзакций.
4. **Топ-10 устройств** с наибольшим числом мошеннических операций.
5. **Доля мошенничества по часам дня** (0–23).
6. **Доля мошенничества по дням недели** (Пн–Вс).

## 7. Основные выводы и гипотезы

### Продуктовые гипотезы
- **IP-блокировка**: автоматическое ограничение подозрительных диапазонов.
- **Верификация устройств**: требование дополнительной аутентификации для рисковых девайсов.
- **Временные лимиты**: ужесточение проверок в часы пик фрода.
- **Гео-оповещения**: предупреждения при нетипичных для клиента странах.

### Технические гипотезы
- Включение метрик `last_hour_activity` в модель улучшит качество.
- Анализ связей между `device_fingerprint` и `customer_id` выявит мошеннические сети.
- Модели на последовательностях транзакций (LSTM/Transformer) покажут лучшие результаты.
- Адаптивная настройка порогов вероятности фрода по регионам и категориям вендоров.
